<ion-content [fullscreen]="true" class="game-content">
  <div class="game-container">
    <!-- Header Section -->
    <div class="header-section">
      <ion-button 
        fill="clear" 
        class="back-btn"
        (click)="goHome()">
        <ion-icon name="chevron-back" slot="icon-only"></ion-icon>
      </ion-button>
      
      <div class="header-content">
        <h1 class="page-title">üî• XotEx</h1>
        <div class="game-status">
          <span class="heat-level">Heat {{ heatLevel }}</span>
          <span class="round-info">Rodada {{ completedRounds + 1 }}</span>
        </div>
      </div>

      <ion-button 
        fill="clear" 
        class="stats-btn"
        (click)="showGameStats()">
        <ion-icon name="stats-chart" slot="icon-only"></ion-icon>
      </ion-button>
    </div>

    <!-- Mystery Box Phase -->
    <div class="mystery-box-section" *ngIf="gamePhase === 'reading'">
      <div class="mystery-box" [class.opening]="isBoxOpening" (click)="openBox()">
        <div class="box-content">
          <div class="box-icon">üì¶</div>
          <h2 class="box-title">Caixa Misteriosa</h2>
          <p class="box-subtitle">Toque para revelar a confiss√£o</p>
        </div>
      </div>
    </div>

    <!-- Confession Display -->
    <div class="confession-section" *ngIf="gamePhase === 'voting' || gamePhase === 'results'">
      <div class="confession-card">
        <div class="confession-header">
          <span class="confession-category">
            {{ getCategoryEmoji(currentConfession?.category) }} {{ currentConfession?.category }}
          </span>
        </div>
        <div class="confession-text">
          "{{ currentConfession?.text }}"
        </div>
      </div>
    </div>

    <!-- Voting Phase -->
    <div class="voting-section" *ngIf="gamePhase === 'voting'">
      <!-- Current Voter -->
      <div class="current-voter" *ngIf="currentVotingPlayer">
        <div class="voter-info">
          <div class="voter-avatar" [style.background-color]="currentVotingPlayer.color">
            {{ currentVotingPlayer.avatar }}
          </div>
          <div class="voter-details">
            <h3>{{ currentVotingPlayer.name }}</h3>
            <p>Sua vez de votar</p>
          </div>
        </div>
      </div>

      <!-- Voting Options -->
      <div class="voting-options" *ngIf="canPlayerVote() && currentVotingPlayer">
        <h4 class="voting-title">Quem escreveu isso?</h4>
        
        <div class="players-grid">
          <button 
            *ngFor="let player of getVotingOptions()"
            class="player-option"
            [class.selected]="currentVote === player.id"
            [style.border-color]="player.color"
            (click)="vote(player.id)">
            <div class="option-avatar" [style.background-color]="player.color">
              {{ player.avatar }}
            </div>
            <span class="option-name">{{ player.name }}</span>
            <div class="selection-indicator" *ngIf="currentVote === player.id">
              <ion-icon name="checkmark-circle"></ion-icon>
            </div>
          </button>
        </div>
        
        <!-- Confirm Vote Button -->
        <div class="vote-confirmation" *ngIf="currentVote">
          <div class="selected-vote">
            <span>Voto selecionado:</span>
            <div class="selected-player">
              <div class="selected-avatar" [style.background-color]="getPlayerById(currentVote)?.color">
                {{ getPlayerById(currentVote)?.avatar }}
              </div>
              <span class="selected-name">{{ getPlayerById(currentVote)?.name }}</span>
            </div>
          </div>
          
          <ion-button 
            expand="full"
            class="confirm-vote-btn"
            (click)="confirmVote()">
            <ion-icon name="checkmark" slot="start"></ion-icon>
            Confirmar Voto
          </ion-button>
        </div>
      </div>

      <!-- Waiting State -->
      <div class="waiting-state" *ngIf="!canPlayerVote() && !allPlayersVoted() && currentVotingPlayer">
        <div class="waiting-content">
          <div class="waiting-icon">‚è≥</div>
          <h3>Aguardando voto</h3>
          <p>{{ currentVotingPlayer?.name }} est√° votando...</p>
        </div>
      </div>

      <!-- All Voted - Revealing Results -->
      <div class="waiting-state" *ngIf="allPlayersVoted() && gamePhase === 'voting'">
        <div class="waiting-content">
          <div class="waiting-icon">üéØ</div>
          <h3>Todos votaram!</h3>
          <p>Revelando resultados...</p>
        </div>
      </div>
    </div>

    <!-- Results Phase -->
    <div class="results-section" *ngIf="gamePhase === 'results'">
      <div class="results-header">
        <h2 class="results-title">Resultado</h2>
        <div class="author-reveal">
          <div class="author-avatar" [style.background-color]="getAuthor()?.color">
            {{ getAuthor()?.avatar }}
          </div>
          <div class="author-info">
            <h3>{{ getAuthor()?.name }}</h3>
            <p>Escreveu a confiss√£o</p>
          </div>
        </div>
      </div>

      <!-- Voting Results -->
      <div class="votes-results">
        <h4 class="votes-title">Votos recebidos</h4>
        <div class="votes-list">
          <div 
            *ngFor="let vote of getVotesList()"
            class="vote-item">
            <div class="voter-info">
              <div class="vote-avatar" [style.background-color]="getPlayerById(vote.playerId)?.color">
                {{ getPlayerById(vote.playerId)?.avatar }}
              </div>
              <span class="voter-name">{{ getPlayerById(vote.playerId)?.name }}</span>
            </div>
            <div class="voted-for">
              <span class="arrow">‚Üí</span>
              <div class="voted-avatar" [style.background-color]="getPlayerById(vote.votedForId)?.color">
                {{ getPlayerById(vote.votedForId)?.avatar }}
              </div>
              <span class="voted-name">{{ getPlayerById(vote.votedForId)?.name }}</span>
            </div>
            <div class="result-indicator">
              <ion-icon 
                [name]="vote.votedForId === getAuthor()?.id ? 'checkmark-circle' : 'close-circle'"
                [color]="vote.votedForId === getAuthor()?.id ? 'success' : 'danger'">
              </ion-icon>
            </div>
          </div>
        </div>
      </div>

      <!-- Continue Button -->
      <ion-button 
        expand="full"
        class="continue-btn"
        (click)="nextRound()">
        <span *ngIf="!isGameFinished()">Pr√≥xima Rodada</span>
        <span *ngIf="isGameFinished()">Ver Resultados Finais</span>
        <ion-icon name="arrow-forward" slot="end"></ion-icon>
      </ion-button>
    </div>

    <!-- Game Finished -->
    <div class="finished-section" *ngIf="gamePhase === 'finished'">
      <div class="finished-content">
        <div class="trophy-icon">üèÜ</div>
        <h2>Jogo Finalizado!</h2>
        <p>Que tal jogar novamente?</p>
        
        <div class="final-stats" *ngIf="gameStats">
          <div class="stat-item">
            <span class="stat-value">{{ gameStats.totalRounds }}</span>
            <span class="stat-label">Rodadas</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ gameStats.totalVotes }}</span>
            <span class="stat-label">Votos</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{ Math.round(gameStats.averageAccuracy) }}%</span>
            <span class="stat-label">Precis√£o</span>
          </div>
        </div>

        <div class="final-actions">
          <ion-button 
            expand="full"
            class="new-game-btn"
            (click)="startNewGame()">
            <ion-icon name="refresh" slot="start"></ion-icon>
            Novo Jogo
          </ion-button>
          
          <ion-button 
            expand="full"
            fill="outline"
            class="home-btn"
            (click)="goHome()">
            <ion-icon name="home" slot="start"></ion-icon>
            Voltar ao In√≠cio
          </ion-button>
        </div>
      </div>
    </div>
  </div>
</ion-content>
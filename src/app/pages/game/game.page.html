<ion-header [translucent]="true">
  <ion-toolbar color="dark">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/tab1"></ion-back-button>
    </ion-buttons>
    <ion-title>üî• XOTEX üî•</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="showGameStats()">
        <ion-icon name="stats-chart"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="game-content">
  <div class="game-container">
    
    <!-- Game Status - Modern with Left Border -->
    <ion-card class="status-card border-left-heavy modern-glow">
      <ion-card-content>
        <div class="game-status">
          <div class="status-item">
            <ion-icon name="flame"></ion-icon>
            <span>HEAT {{ heatLevel }}</span>
          </div>
          <div class="status-item">
            <ion-icon name="trophy"></ion-icon>
            <span>RODADA {{ completedRounds + 1 }}</span>
          </div>
          <div class="status-item">
            <ion-icon name="people"></ion-icon>
            <span>{{ players.length }} PLAYERS</span>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Mystery Box - Modern Minimalist -->
    <div class="mystery-box-container" *ngIf="gamePhase === 'reading'">
      <div class="mystery-box border-round-thick" [class.opening]="isBoxOpening" (click)="openBox()">
        <div class="box-top">
          <div class="box-emoji">üì¶</div>
          <div class="box-text">CAIXA MISTERIOSA</div>
          <div class="box-subtitle">Toque para revelar</div>
        </div>
      </div>
    </div>

    <!-- Confession Display - Modern with Bottom Border -->
    <ion-card class="confession-card border-bottom-heavy subtle-pulse" *ngIf="gamePhase === 'voting' || gamePhase === 'results'">
      <ion-card-header>
        <ion-card-title>
          <ion-icon name="chatbubble"></ion-icon>
          CONFISS√ÉO REVELADA
        </ion-card-title>
        <ion-card-subtitle>
          {{ getCategoryEmoji(currentConfession?.category) }} {{ currentConfession?.category?.toUpperCase() }}
        </ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <div class="confession-text">
          "{{ currentConfession?.text }}"
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Voting Phase - Modern Design -->
    <div class="voting-section" *ngIf="gamePhase === 'voting'">
      
      <!-- Current Player Turn - Modern with Thick Border -->
      <ion-card class="current-player-card border-round-thick modern-glow" *ngIf="currentVotingPlayer">
        <ion-card-content>
          <div class="current-player-turn">
            <div class="turn-indicator">
              <div class="turn-avatar" [style.background-color]="currentVotingPlayer.color">
                {{ currentVotingPlayer.avatar }}
              </div>
              <div class="turn-info">
                <h3>VEZ DE {{ currentVotingPlayer.name.toUpperCase() }}</h3>
                <p>Passe o celular para {{ currentVotingPlayer.name.toUpperCase() }} votar</p>
              </div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Voting Options - Modern Square Design -->
      <ion-card class="voting-card border-square-thin" *ngIf="canPlayerVote() && currentVotingPlayer">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="help-circle"></ion-icon>
            QUEM ESCREVEU ESTA CONFISS√ÉO?
          </ion-card-title>
          <ion-card-subtitle>
            {{ currentVotingPlayer.name.toUpperCase() }}, escolha quem voc√™ acha que foi o autor
          </ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <div class="players-voting-grid" *ngIf="getVotingOptions().length > 0">
            <div 
              *ngFor="let player of getVotingOptions()"
              class="voting-player-card border-sharp"
              [class.selected]="currentVote === player.id"
              [class.neon-strobe]="currentVote === player.id"
              [style.background-color]="player.color"
              (click)="vote(player.id)">
              <div class="voting-player-info">
                <div class="voting-player-avatar">{{ player.avatar }}</div>
                <div class="voting-player-name text-pure-black">{{ player.name.toUpperCase() }}</div>
              </div>
              <ion-icon 
                *ngIf="currentVote === player.id"
                name="checkmark-circle"
                class="selected-icon bg-neon-green">
              </ion-icon>
            </div>
          </div>
          
          <div class="voting-actions" *ngIf="currentVote && canPlayerVote()">
            <ion-button 
              expand="full"
              size="large"
              (click)="confirmVote()"
              class="confirm-vote-button bg-neon-green border-pure-black neon-pulse">
              <ion-icon name="checkmark" slot="start"></ion-icon>
              ‚úÖ CONFIRMAR VOTO
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Voting Progress - NEON PROGRESS -->
      <ion-card class="voting-progress-card border-neon-blue" *ngIf="players && players.length > 0">
        <ion-card-header>
          <ion-card-title class="text-neon-purple neon-flash">
            <ion-icon name="people" class="neon-pulse"></ion-icon>
            üìä PROGRESSO DA VOTA√á√ÉO
          </ion-card-title>
          <ion-card-subtitle class="text-pure-black">
            {{ getVotesCount() }} DE {{ players.length }} JOGADORES VOTARAM
          </ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <div class="voting-progress">
            <div 
              *ngFor="let player of players"
              class="voting-progress-item bg-pure-black text-pure-white"
              [class.voted]="hasPlayerVoted(player.id)"
              [class.current]="isCurrentPlayerTurn(player.id)"
              [class.bg-neon-green]="hasPlayerVoted(player.id)"
              [class.bg-neon-yellow]="isCurrentPlayerTurn(player.id)"
              [class.text-pure-black]="hasPlayerVoted(player.id) || isCurrentPlayerTurn(player.id)"
              [class.neon-strobe]="isCurrentPlayerTurn(player.id)">
              <span class="progress-avatar">{{ player.avatar }}</span>
              <span class="progress-name">{{ player.name.toUpperCase() }}</span>
              <div class="progress-status">
                <ion-icon 
                  *ngIf="hasPlayerVoted(player.id)"
                  name="checkmark-circle"
                  color="success"
                  class="text-pure-black">
                </ion-icon>
                <ion-icon 
                  *ngIf="isCurrentPlayerTurn(player.id) && !hasPlayerVoted(player.id)"
                  name="time"
                  color="warning"
                  class="text-pure-black neon-flash">
                </ion-icon>
                <span 
                  *ngIf="!hasPlayerVoted(player.id) && !isCurrentPlayerTurn(player.id)"
                  class="waiting-indicator">‚è≥</span>
              </div>
            </div>
          </div>
          
          <ion-button 
            *ngIf="allPlayersVoted()"
            expand="full"
            (click)="revealResults()"
            class="reveal-button bg-neon-orange border-pure-black neon-pulse">
            <ion-icon name="eye" slot="start"></ion-icon>
            üëÅÔ∏è REVELAR RESULTADO
          </ion-button>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Results Phase - NEON EXPLOSION -->
    <div class="results-section" *ngIf="gamePhase === 'results' && roundResult">
      <ion-card class="results-card border-neon-red neon-flash">
        <ion-card-header>
          <ion-card-title class="text-neon-purple neon-strobe">
            <ion-icon name="trophy" class="neon-rotate"></ion-icon>
            üèÜ RESULTADO DA RODADA üèÜ
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <!-- Author Reveal - NEON BLAST -->
          <div class="author-reveal">
            <h3 class="text-pure-black">‚ö° O AUTOR DA CONFISS√ÉO FOI: ‚ö°</h3>
            <div 
              class="author-card neon-pulse border-pure-black"
              [style.background-color]="roundResult.actualAuthor.color">
              <div class="author-avatar">{{ roundResult.actualAuthor.avatar }}</div>
              <div class="author-name text-pure-black">{{ roundResult.actualAuthor.name.toUpperCase() }}</div>
            </div>
          </div>

          <!-- Vote Results - NEON STATS -->
          <div class="vote-results">
            <h4 class="text-neon-purple">üìä RESULTADOS DOS VOTOS:</h4>
            <div class="vote-results-list">
              <div 
                *ngFor="let result of roundResult.votes"
                class="vote-result-item border-sharp"
                [class.correct]="result.isCorrect"
                [class.bg-neon-green]="result.isCorrect"
                [class.text-pure-black]="result.isCorrect"
                [class.bg-pure-black]="!result.isCorrect"
                [class.text-pure-white]="!result.isCorrect">
                <div class="vote-player-info">
                  <span class="vote-player-name">{{ result.playerName.toUpperCase() }}</span>
                  <span class="vote-count">{{ result.votes }} VOTO(S)</span>
                </div>
                <ion-icon 
                  [name]="result.isCorrect ? 'checkmark-circle' : 'close-circle'"
                  [class.text-pure-black]="result.isCorrect"
                  [class.text-neon-red]="!result.isCorrect">
                </ion-icon>
              </div>
            </div>
          </div>

          <!-- Consequences - NEON PICANTE -->
          <div class="consequences">
            <div class="consequence-section" *ngIf="roundResult.correctGuessers.length > 0">
              <h4 class="text-neon-purple">üéâ ACERTARAM E DISTRIBUEM DOSES:</h4>
              <div class="consequence-players">
                <div 
                  *ngFor="let player of roundResult.correctGuessers"
                  class="consequence-player correct bg-neon-green border-pure-black">
                  <span class="consequence-avatar">{{ player.avatar }}</span>
                  <span class="consequence-name text-pure-black">{{ player.name.toUpperCase() }}</span>
                  <span class="consequence-action text-pure-black">üëë DISTRIBUI!</span>
                </div>
              </div>
            </div>
            
            <div class="consequence-section" *ngIf="roundResult.wrongGuessers.length > 0">
              <h4 class="text-neon-purple">üç∫ ERRARAM E DEVEM BEBER:</h4>
              <div class="consequence-players">
                <div 
                  *ngFor="let player of roundResult.wrongGuessers"
                  class="consequence-player wrong bg-neon-red border-pure-black">
                  <span class="consequence-avatar">{{ player.avatar }}</span>
                  <span class="consequence-name text-pure-white">{{ player.name.toUpperCase() }}</span>
                  <span class="consequence-action text-pure-white">üçª BEBE!</span>
                </div>
              </div>
            </div>

            <div class="author-story-section bg-neon-yellow border-pure-black border-soft">
              <h4 class="text-pure-black">üìñ {{ roundResult.actualAuthor.name.toUpperCase() }}, CONTE A HIST√ìRIA COMPLETA!</h4>
              <p class="story-instruction text-pure-black">
                ‚ö° AGORA √â A HORA DE {{ roundResult.actualAuthor.name.toUpperCase() }} CONTAR TODOS OS DETALHES SOBRE ESSA CONFISS√ÉO! üé≠‚ö°
              </p>
            </div>
          </div>

          <!-- Continue Button - NEON POWER -->
          <div class="continue-actions">
            <ion-button 
              expand="full"
              size="large"
              (click)="nextRound()"
              class="next-round-button bg-neon-purple border-pure-black neon-pulse">
              <ion-icon name="arrow-forward" slot="end" class="neon-flash"></ion-icon>
              üöÄ PR√ìXIMA RODADA
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Game Finished - NEON CELEBRATION -->
    <div class="game-finished-section" *ngIf="gamePhase === 'finished'">
      <ion-card class="finished-card border-neon-green neon-flash">
        <ion-card-header>
          <ion-card-title class="text-neon-green neon-strobe">
            <ion-icon name="checkmark-circle" class="neon-rotate"></ion-icon>
            üéâ JOGO FINALIZADO! üéâ
          </ion-card-title>
          <ion-card-subtitle class="text-pure-black">
            üèÜ PARAB√âNS! VOC√äS REVELARAM TODAS AS CONFISS√ïES DISPON√çVEIS. üèÜ
          </ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <div class="final-stats" *ngIf="gameStats">
            <h3 class="text-neon-purple">üìà ESTAT√çSTICAS FINAIS:</h3>
            <div class="stats-list">
              <div class="stat-item bg-pure-black border-sharp">
                <ion-icon name="trophy" class="text-neon-yellow neon-flash"></ion-icon>
                <span class="text-pure-white">{{ gameStats.totalRounds }} RODADAS JOGADAS</span>
              </div>
              <div class="stat-item bg-pure-black border-sharp">
                <ion-icon name="flame" class="text-neon-orange neon-pulse"></ion-icon>
                <span class="text-pure-white">HEAT LEVEL M√ÅXIMO: {{ gameStats.heatLevel }}</span>
              </div>
            </div>
            
            <div class="player-final-stats">
              <h4 class="text-neon-purple">üéØ DESEMPENHO DOS JOGADORES:</h4>
              <div 
                *ngFor="let stat of gameStats.playerStats"
                class="player-stat-item bg-pure-black border-sharp">
                <div class="player-stat-info">
                  <span class="stat-avatar">{{ stat.player.avatar }}</span>
                  <span class="stat-name text-pure-white">{{ stat.player.name.toUpperCase() }}</span>
                </div>
                <div class="player-stat-data">
                  <span class="stat-accuracy text-neon-green">{{ stat.accuracy.toFixed(1) }}% ACERTOS</span>
                  <span class="stat-confessions text-neon-pink">{{ stat.confessionsRevealed }} CONFISS√ïES REVELADAS</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="finish-actions">
            <ion-button 
              expand="full"
              size="large"
              (click)="goHome()"
              class="home-button bg-neon-purple border-pure-black neon-pulse">
              <ion-icon name="home" slot="start" class="neon-flash"></ion-icon>
              üè† VOLTAR AO IN√çCIO
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

  </div>

  <!-- Toast de erro - NEON STYLE -->
  <ion-toast
    [isOpen]="showErrorToast"
    [message]="errorMessage"
    duration="3000"
    color="danger"
    position="top"
    class="neon-strobe"
    (didDismiss)="showErrorToast = false">
  </ion-toast>
</ion-content>
